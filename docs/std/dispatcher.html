<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Dispatcher · Cats Effect</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="![](/cats-effect/docs/assets/dispatcher.jpeg)"/><meta name="docsearch:version" content="3.x"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Dispatcher · Cats Effect"/><meta property="og:type" content="website"/><meta property="og:url" content="https://typelevel.org/cats-effect/"/><meta property="og:description" content="![](/cats-effect/docs/assets/dispatcher.jpeg)"/><meta property="og:image" content="https://typelevel.org/cats-effect/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://typelevel.org/cats-effect/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/cats-effect/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/cats-effect/js/scrollSpy.js"></script><link rel="stylesheet" href="/cats-effect/css/main.css"/><script src="/cats-effect/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/cats-effect/"><img class="logo" src="/cats-effect/img/cats-effect-logo.svg" alt="Cats Effect"/><h2 class="headerTitleWithLogo">Cats Effect</h2></a><a href="/cats-effect/versions"><h3>3.x</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/cats-effect/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="/cats-effect/api/3.x/cats/effect/index.html" target="_self">API</a></li><li class=""><a href="https://github.com/typelevel/cats-effect" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Standard Library</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/concepts">Concepts</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/tutorial">Tutorial</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/recipes">Recipes</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/migration-guide">Migration Guide</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/third-party-resources">Third-Party Learning Resources</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Core Runtime<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/test-runtime">Test Runtime</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/fiber-dumps">Fiber Dumps</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/tracing">Tracing</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/thread-model">Thread Model</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/schedulers">Schedulers</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/starvation-and-tuning">Starvation and Tuning</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/io-runtime-config">IORuntime Configuration</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/native-image">GraalVM Native Image</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/scala-native">Scala Native</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/jlink">Jlink image</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/io-local">IOLocal</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Typeclasses<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses">Overview</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/monadcancel">MonadCancel</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/spawn">Spawn</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/unique">Unique</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/clock">Clock</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/concurrent">Concurrent</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/temporal">Temporal</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/sync">Sync</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/async">Async</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Standard Library<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/atomic-cell">Atomic Cell</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/backpressure">Backpressure</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/console">Console</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/countdown-latch">Count Down Latch</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/cyclic-barrier">Cyclic Barrier</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/deferred">Deferred</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/dequeue">Dequeue</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/cats-effect/docs/std/dispatcher">Dispatcher</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/env">Env</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/hotswap">Hotswap</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/mutex">Mutex</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/pqueue">Priority Queue</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/queue">Queue</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/random">Random</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/ref">Ref</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/resource">Resource</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/semaphore">Semaphore</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/supervisor">Supervisor</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/async-await">Async/Await (Experimental)</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Dispatcher</h1></header><article><div><span><p><img src="/cats-effect/docs/assets/dispatcher.jpeg" alt=""></p>
<p><code>Dispatcher</code> is a <a href="/cats-effect/docs/concepts#fibers">fiber</a>-based <a href="/cats-effect/docs/std/supervisor"><code>Supervisor</code></a> utility for evaluating effects across an impure boundary. This is useful when working with reactive interfaces that produce potentially many values (as opposed to one), and for each value, some effect in <code>F</code> (like inserting each value into a queue) must be performed as a side effect by an impure callback. This allows effectful code to be sequenced within the control flow of impure code, reversing the more common scenario where impure code, suspended using <code>delay</code> or <code>blocking</code>, is sequenced within effectful code.</p>
<p>An instance of <code>Dispatcher</code> can be derived for any effect type conforming to the <a href="/cats-effect/docs/typeclasses/async"><code>Async</code></a> typeclass.</p>
<p>Let's say we are integrating with an interface that looks like this:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImpureInterface</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onMessage</span></span>(msg: <span class="hljs-type">String</span>): <span class="hljs-type">Unit</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init</span></span>(): <span class="hljs-type">Unit</span> = {
    onMessage(<span class="hljs-string">"init"</span>)
  }

  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>As a user we're supposed to create an implementation of this class where we implement <code>onMessage</code>.</p>
<p>Let's say that we have a <a href="/cats-effect/docs/std/queue"><code>queue</code></a> and that we want to add each message received to the queue. We might,
naively, try to do the following</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">for</span> {
    queue &lt;- <span class="hljs-type">Queue</span>.unbounded[<span class="hljs-type">IO</span>, <span class="hljs-type">String</span>]
    impureInterface = <span class="hljs-keyword">new</span> <span class="hljs-type">ImpureInterface</span> {
      <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onMessage</span></span>(msg: <span class="hljs-type">String</span>): <span class="hljs-type">Unit</span> = queue.offer(msg) <span class="hljs-comment">// This returns an IO, so nothing really happens!</span>
    }
    _ &lt;- <span class="hljs-type">IO</span>.delay(impureInterface.init())
    value &lt;- queue.tryTake
  } <span class="hljs-keyword">yield</span> value <span class="hljs-keyword">match</span> {
    <span class="hljs-keyword">case</span> <span class="hljs-type">Some</span>(v) =&gt; println(<span class="hljs-string">s"Value found in queue! <span class="hljs-subst">$v</span>"</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-type">None</span>    =&gt; println(<span class="hljs-string">"Value not found in queue :("</span>)
  }
</code></pre>
<p>This will print &quot;Value not found in queue :(&quot;, since our implementation of <code>onMessage</code>
doesn't really <em>do</em> anything. It just creates an <code>IO</code> value which is just a description of an effect,
without actually executing it. (Here the <code>scalac</code> option <code>-Ywarn-value-discard</code> might help hint at this problem.)</p>
<p>It is in these cases that <code>Dispatcher</code> comes in handy. Here's how it could be used:</p>
<pre><code class="hljs css language-scala"><span class="hljs-type">Dispatcher</span>.sequential[<span class="hljs-type">IO</span>] use { dispatcher =&gt;
  <span class="hljs-keyword">for</span> {
    queue &lt;- <span class="hljs-type">Queue</span>.unbounded[<span class="hljs-type">IO</span>, <span class="hljs-type">String</span>]
    impureInterface &lt;-
      <span class="hljs-type">IO</span>.delay {
        <span class="hljs-keyword">new</span> <span class="hljs-type">ImpureInterface</span> {
          <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">onMessage</span></span>(msg: <span class="hljs-type">String</span>): <span class="hljs-type">Unit</span> =
            dispatcher.unsafeRunAndForget(queue.offer(msg))
        }
      }
    _ &lt;- <span class="hljs-type">IO</span>.delay(impureInterface.init())
    value &lt;- queue.tryTake
  } <span class="hljs-keyword">yield</span> value <span class="hljs-keyword">match</span> {
    <span class="hljs-keyword">case</span> <span class="hljs-type">Some</span>(v) =&gt; println(<span class="hljs-string">s"Value found in queue! <span class="hljs-subst">$v</span>"</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-type">None</span>    =&gt; println(<span class="hljs-string">"Value not found in queue :("</span>)
  }
}
</code></pre>
<p>It prints &quot;Value found in queue! init&quot;!</p>
<p>The example above calls <code>unsafeRunAndForget</code> on the dispatcher, but more functions are exposed:</p>
<pre><code class="hljs css language-scala">
<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Dispatcher</span>[<span class="hljs-type">F</span>[_]] <span class="hljs-keyword">extends</span> <span class="hljs-title">DispatcherPlatform</span>[<span class="hljs-type">F</span>] </span>{

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unsafeToFutureCancelable</span></span>[<span class="hljs-type">A</span>](fa: <span class="hljs-type">F</span>[<span class="hljs-type">A</span>]): (<span class="hljs-type">Future</span>[<span class="hljs-type">A</span>], () =&gt; <span class="hljs-type">Future</span>[<span class="hljs-type">Unit</span>])

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unsafeToFuture</span></span>[<span class="hljs-type">A</span>](fa: <span class="hljs-type">F</span>[<span class="hljs-type">A</span>]): <span class="hljs-type">Future</span>[<span class="hljs-type">A</span>] =
    unsafeToFutureCancelable(fa)._1

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unsafeRunCancelable</span></span>[<span class="hljs-type">A</span>](fa: <span class="hljs-type">F</span>[<span class="hljs-type">A</span>]): () =&gt; <span class="hljs-type">Future</span>[<span class="hljs-type">Unit</span>] =
    unsafeToFutureCancelable(fa)._2

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unsafeRunAndForget</span></span>[<span class="hljs-type">A</span>](fa: <span class="hljs-type">F</span>[<span class="hljs-type">A</span>]): <span class="hljs-type">Unit</span> = {
    unsafeToFutureCancelable(fa)
    ()
  }

  <span class="hljs-comment">//Only on the JVM</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unsafeRunSync</span></span>[<span class="hljs-type">A</span>](fa: <span class="hljs-type">F</span>[<span class="hljs-type">A</span>]): <span class="hljs-type">A</span>
}
</code></pre>
<p>Creating an instance of <code>Dispatcher</code> is very cheap - you are encouraged to instantiate it
where necessary rather than wiring a single instance throughout an application.</p>
<h2><a class="anchor" aria-hidden="true" id="cats-effect-2"></a><a href="#cats-effect-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect 2</h2>
<p>Users of Cats Effect 2 may be familiar with the <code>Effect</code> and <code>ConcurrentEffect</code>
typeclasses. These have been removed as they constrained implementations of the
typeclasses too much by forcing them to be embeddable in <code>IO</code> via <code>def toIO[A](fa: F[A]): IO[A]</code>. However, these typeclasses also had a valid use-case
for unsafe running of effects to interface with impure APIs (<code>Future</code>, <code>NIO</code>,
etc). <code>Dispatcher</code> now addresses this use-case.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/cats-effect/docs/std/dequeue"><span class="arrow-prev">← </span><span>Dequeue</span></a><a class="docs-next button" href="/cats-effect/docs/std/env"><span>Env</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#cats-effect-2">Cats Effect 2</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/cats-effect/" class="nav-home"><img src="/cats-effect/img/cats-effect-logo.svg" alt="Cats Effect" width="66" height="58"/></a><div><h5>Docs</h5><a href="/cats-effect/docs/getting-started">Getting Started</a><a href="/cats-effect/docs/tutorial">Tutorial</a><a href="/cats-effect/docs/typeclasses">Typeclasses</a><a href="/cats-effect/docs/schedulers">Schedulers</a></div><div><h5>Community</h5><a target="_blank" href="https://typelevel.org/blog/">Blog</a><a target="_blank" href="https://discord.gg/HmPs7rAtEY">Discord</a></div><div><h5>More</h5><a class="github-button" href="https://github.com/typelevel/cats-effect" data-icon="octicon-star" data-count-href="/typelevel/cats-effect/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/typelevel" class="twitter-follow-button">Follow @typelevel</a></div></div></section><section class="copyright">Copyright (c) 2017-2022 Typelevel</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>